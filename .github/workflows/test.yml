name: CI - Synara FPT Integration
on: [push, pull_request]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install deps
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest -q

  receipts-check:
    runs-on: ubuntu-latest
    needs: unit-tests
    steps:
      - uses: actions/checkout@v4
      - name: Generate test handshake
        run: |
          python - <<'PY'
          from synara_core.handshake import Handshake
          h = Handshake('ci-node')
          r = h.create_receipt({'test': 'ci-run'})
          print(r['payload_hash'])
          PY
      - name: Upload receipt
        uses: actions/upload-artifact@v4
        with:
          name: ci-receipt
          path: /var/lib/synara/receipts