image:
  repository: ghcr.io/ak-skwaa-mahawk/feedback_processor_theory
  tag: latest
  pullPolicy: IfNotPresent

replicaCount: 2

service:
  type: ClusterIP
  port: 80
  targetPort: 8081

ingress:
  enabled: false
  className: nginx
  hosts:
    - host: synara.local
      paths:
        - path: /
          pathType: Prefix
  tls: []  # [{ secretName: synara-tls, hosts: [synara.example.com]}]

env:
  CAP_TOKEN_SECRET: ""
  WHISPER_SECRET: ""
  CAP_REDIS_URL: "redis://redis:6379/0"
  RESONANCE_POLICY_PATH: "/app/resonance/policy.yaml"

resources:
  limits: { cpu: "500m", memory: "512Mi" }
  requests: { cpu: "200m", memory: "256Mi" }

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 8
  targetCPUUtilizationPercentage: 70

redis:
  enabled: true
  image: "redis:7-alpine"
env:
  WHISPER_HARDENING_ENABLED: "1"
  PAD_MIN_MS: "80"
  PAD_MAX_MS: "220"
  PAD_MIN_BYTES: "512"
  PAD_MAX_BYTES: "2048"
  RL_BUCKET_CAP: "60"
  RL_REFILL_PER_SEC: "1.0"
  REDIS_URL: "redis://redis:6379/0"

nginx:
  extraConfig: |
    gzip  off;
    server_tokens off;

    location ~ ^/(verify|codex/(share|delegate|resonance_share|resonance_share/v2))$ {
      gzip off;
      add_header Content-Encoding "identity";
      proxy_set_header Accept-Encoding "";
      proxy_pass http://synara:8080;
    }